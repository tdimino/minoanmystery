---
/**
 * ChatInput - Chat input form with attachment support
 * Includes text input, attach button, submit button, and keyboard hints
 *
 * Note: Behavior is controlled by parent page's JavaScript via IDs.
 * This component is primarily for HTML organization.
 */

interface Props {
  placeholder?: string;
  showHints?: boolean;
}

const {
  placeholder = 'Ask Kothar...',
  showHints = true,
} = Astro.props;
---

<form id="labyrinth-form" class="labyrinth-form">
  <!-- Hidden file input for image selection -->
  <input
    type="file"
    id="image-input"
    class="image-input-hidden"
    accept="image/png,image/jpeg,image/webp"
    aria-hidden="true"
  />

  <!-- Attachment preview bar (shown when image pending) -->
  <div id="attachment-preview" class="attachment-preview-bar" style="display: none;">
    <img id="attachment-thumbnail" class="attachment-thumbnail" src="" alt="Attachment preview" />
    <button type="button" id="attachment-dismiss" class="attachment-dismiss" aria-label="Remove attachment">
      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
  </div>

  <div class="form-input-wrapper">
    <input
      type="text"
      id="labyrinth-input"
      class="labyrinth-input"
      placeholder={placeholder}
      autocomplete="off"
      spellcheck="false"
      aria-label="Message to Kothar"
    />
    <!-- Attach image button -->
    <button type="button" id="attach-button" class="attach-button" aria-label="Attach image">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path>
      </svg>
    </button>
    <button type="submit" class="labyrinth-submit" aria-label="Send message">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="22" y1="2" x2="11" y2="13"></line>
        <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
      </svg>
    </button>
  </div>

  {showHints && (
    <div class="form-hints">
      <kbd>Enter</kbd> to send
      <span class="hint-separator">•</span>
      <kbd>Cmd+K</kbd> for commands
      <span class="hint-separator">•</span>
      <span class="hint-paste">Paste image</span>
    </div>
  )}
</form>
